VAD Notes
https://chat.deepseek.com/share/f9y546rr7z1ss1g3sc

#VAD + Gating with Circular Buffer

Memory Address: [0][1][2][3][4][5][6][7]...[N-1]
                    ^                       ^
                    |                       |
                Write Pointer          Read Pointer




                    [IDLE]
                       |
                 VAD = 1?
                       |
                    [PRE-TRIGGER]
                       |
                Hangover Timer?
                       |
              +--------+--------+
              |                 |
         VAD = 1?           VAD = 0?
              |                 |
         [RECORDING] <---- [HANGOVER]
              |                 |
              +-----------------+
                       |
                 Timer Expired?
                       |
                    [DONE]
                       |
              Send audio for processing
                       |
                       v
                    [IDLE]



                    ┌─────────────────┐
Audio In ─────┬────>│ Circular Buffer │<──── Always Writing
              │     │    (500ms)       │
              │     └────────┬────────┘
              │              │
              │     ┌────────▼────────┐
              └────>│      VAD         │
                    │ (Energy + ZCR)   │
                    └────────┬────────┘
                             │ VAD Flag
                    ┌────────▼────────┐
                    │  State Machine  │
                    │ (IDLE/TRIG/REC/ │
                    │  HANG/DONE)     │
                    └────────┬────────┘
                             │ Control
                    ┌────────▼────────┐
                    │ Output FIFO     │────> To Processing
                    │ (Full Utterance)│
                    └─────────────────┘


audio_in → [Square] → [Accumulate 10ms] → short_term_energy
                                              |
                                              ↓
                                    [Low-pass Filter] 
                                              | α=0.95
                                              ↓
                                    smoothed_energy
                                              |
                    ┌─────────────────────────┴─────────────────────────┐
                    ↓                         ↓                          ↓
            [Compare to               [Hysteresis                 [Hangover
             Threshold]                 Logic]                      Timer]
                    ↓                         ↓                          ↓
              vad_raw ───────────→ speech_detected ───────────→ recording_active
